<!DOCTYPE HTML>

<html lang="en">
  <head>
    <title>explore</title>
    <meta charset="utf-8">
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  </head>

  <body>
    <div id="content">
      <canvas id="c" width=1280 height=720></canvas>
    </div> 

    <script type="module">

import * as THREE from "./build/three.module.js";
import {Chunk} from "./src/game.js";
import {basicPopulate} from "./src/gen.js";

const IMPULSE = {};
const canvas = document.querySelector('#c');
document.addEventListener("keydown", (e) => {
  IMPULSE[e.key] = true;
});
document.addEventListener("keyup", (e) => {
  IMPULSE[e.key] = false;
});

const renderer = new THREE.WebGLRenderer({canvas});
renderer.setSize(1280,720,false);
const camera = new THREE.PerspectiveCamera(75, 2, 0.1, 1000);
camera.position.z = 100;
camera.position.y = 20;
camera.position.x = 20;

const scene = new THREE.Scene();

const chunkSet = [];
for (let i = 0; i < 3; i++) {
  for (let j = 0; j < 3; j++) {
    const c = new Chunk(i, j);
    basicPopulate(c);
    chunkSet.push(c);
  }
}


for (let c of chunkSet) {
  scene.add(c.getMesh());
}

const light = new THREE.DirectionalLight(0xffffff, 0.4);
light.position.set(1, 2, 3);
scene.add(light);


let lastTime = 0;
const cspeed = -8.2;
function render(time) {
  const dt = (lastTime - time) * 0.001;
  lastTime = time;

  if (IMPULSE["w"]) {
    camera.position.z -= cspeed*dt;
  }
  else if(IMPULSE["s"]) {
    camera.position.z += cspeed*dt;
  }

  if (IMPULSE["a"]) {
    camera.position.x -= cspeed*dt;
  }
  else if(IMPULSE["d"]) {
    camera.position.x += cspeed*dt;
  }

  if (IMPULSE["q"]) {
    camera.position.y -= cspeed*dt;
  }
  else if(IMPULSE["e"]) {
    camera.position.y += cspeed*dt;
  }

  renderer.render(scene, camera);

  requestAnimationFrame(render);
}

requestAnimationFrame(render);


    </script>
  </body>

</html>
